module.exports= (path) ->
    fs= require 'fs'

    # События процесса
    events= [
        'SIGHUP', 'SIGINT', 'SIGQUIT', 'SIGILL', 'SIGTRAP', 'SIGABRT', 'SIGBUS',
        'SIGFPE', 'SIGUSR1', 'SIGSEGV', 'SIGUSR2', 'SIGPIPE', 'SIGTERM'
    ]

    onkill= (sig) ->
        try
            if fs.existsSync path
                fs.unlink path, (err) ->
                    if err
                        console.log do err.toString

                    if typeof sig == 'string'
                        console.log "Received - terminating Node server ... #{sig}"
                        process.exit 1
                console.log 'Node server stopped.'

    # Пишем pid в файл
    fs.writeFile path, process.pid.toString() + '\n', (err) ->
        if err
            console.log 'Error create PID'
        else
            console.log "PID: #{process.pid.toString()}"

    process.on 'exit', ->
        do onkill

    events.forEach (element) ->
        process.on element, ->
            onkill element
